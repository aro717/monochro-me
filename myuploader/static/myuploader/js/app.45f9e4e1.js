(function(){"use strict";var e={2417:function(e,t,i){var o=i(9963),n=i(6252),s=i.p+"../static/myuploader/img/logo.dfd07daf.svg";const r={id:"app"},a={if:"side"},p=(0,n._)("img",{src:s,id:"header-logo"},null,-1),d={id:"main"};function l(e,t,i,s,l,c){const u=(0,n.up)("router-link"),m=(0,n.up)("router-view");return(0,n.wg)(),(0,n.iD)("div",r,[(0,n._)("header",a,[(0,n.Wm)(u,{id:"rl",to:{name:"home"}},{default:(0,n.w5)((()=>[p])),_:1})]),(0,n._)("main",d,[(0,n.Wm)(o.uT,{appear:""},{default:(0,n.w5)((()=>[(0,n.Wm)(m)])),_:1})])])}var c={name:"app"},u=i(3744);const m=(0,u.Z)(c,[["render",l]]);var h=m,f=i(2201);const g={id:"list"},y={class:"parent composite-wrapper",key:-1},k={class:"current composite-wrapper",key:-1},b={id:"form"};function v(e,t,i,o,s,r){const a=(0,n.up)("Composite"),p=(0,n.up)("composite-form");return(0,n.wg)(),(0,n.iD)("section",{key:r.getKey,id:"composites"},[(0,n._)("div",g,[s.current.parent?((0,n.wg)(),(0,n.iD)("div",{class:"parent composite-wrapper",key:s.current.parent.pk},[(0,n.Wm)(a,{data:s.current.parent,onClick:r.moveBefore},null,8,["data","onClick"])])):s.current.pk?((0,n.wg)(),(0,n.iD)("div",y,[(0,n.Wm)(a,{data:{name:"home",is_dir:"true"},onClick:r.moveBefore},null,8,["onClick"])])):(0,n.kq)("",!0),s.current.pk?((0,n.wg)(),(0,n.iD)("div",{class:"current composite-wrapper",key:s.current.pk},[(0,n.Wm)(a,{data:s.current,editableIn:!0,onCreateDir:r.createDir,onCreateFile:r.createFile},null,8,["data","onCreateDir","onCreateFile"])])):((0,n.wg)(),(0,n.iD)("div",k,[(0,n.Wm)(a,{data:{name:"home",is_dir:"true"},editableIn:!0,onCreateDir:r.createDir,onCreateFile:r.createFile},null,8,["onCreateDir","onCreateFile"])])),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(s.current.composite_set,(e=>((0,n.wg)(),(0,n.iD)("div",{class:"child composite-wrapper",key:e.pk},[(0,n.Wm)(a,{data:e,onClick:r.move,onRemove:r.remove,onUpdate:r.update,zipUrl:r.zipUrl(e),editable:!0},null,8,["data","onClick","onRemove","onUpdate","zipUrl"])])))),128))]),(0,n._)("div",b,[((0,n.wg)(),(0,n.j4)(p,{selected:s.selected,onDone:r.reload,onClose:r.close,key:s.selected.type+"-"+s.selected.data.pk},null,8,["selected","onDone","onClose"]))])])}i(7658);var _=i(3577),w=i.p+"../static/myuploader/img/dir.6bb4de51.svg",C=i.p+"../static/myuploader/img/file.a84efd5a.svg",D=i.p+"../static/myuploader/img/add_file.c0ef87d0.svg",$=i.p+"../static/myuploader/img/add_dir.e18f08cc.svg",z=i.p+"../static/myuploader/img/update.124bc937.svg",F=i.p+"../static/myuploader/img/delete.cd761876.svg",P=i.p+"../static/myuploader/img/zip.ead187fe.svg";const j=e=>((0,n.dD)("data-v-1cdf5e30"),e=e(),(0,n.Cn)(),e),O={class:"composite"},T={key:0,src:w,class:"dir-icon"},U={key:1,src:C,class:"file-icon"},B={key:2,class:"id"},I=j((()=>(0,n._)("img",{src:D,class:"add-file-button-icon"},null,-1))),x=[I],L=j((()=>(0,n._)("img",{src:$,class:"add-dir-button-icon"},null,-1))),S=[L],M=j((()=>(0,n._)("img",{src:z,class:"update-button-icon"},null,-1))),E=[M],W=j((()=>(0,n._)("img",{src:F,class:"delete-button-icon"},null,-1))),Z=[W],q=["href"],R=j((()=>(0,n._)("img",{src:P,class:"zip-button-icon"},null,-1))),N=[R];function V(e,t,i,o,s,r){return(0,n.wg)(),(0,n.iD)("div",O,[i.data.is_dir?((0,n.wg)(),(0,n.iD)("img",T)):((0,n.wg)(),(0,n.iD)("img",U)),i.data.pk?((0,n.wg)(),(0,n.iD)("span",B,(0,_.zw)(i.data.pk),1)):(0,n.kq)("",!0),(0,n._)("a",{class:"composite-link",onClick:t[0]||(t[0]=(...e)=>r.onclick&&r.onclick(...e))},(0,_.zw)(i.data.name),1),i.editableIn?((0,n.wg)(),(0,n.iD)(n.HY,{key:3},[(0,n._)("button",{type:"button",onClick:t[1]||(t[1]=(...e)=>r.createFile&&r.createFile(...e)),class:"img-button add-dir"},x),(0,n._)("button",{type:"button",onClick:t[2]||(t[2]=(...e)=>r.createDir&&r.createDir(...e)),class:"img-button add-file"},S)],64)):(0,n.kq)("",!0),i.editable?((0,n.wg)(),(0,n.iD)(n.HY,{key:4},[(0,n._)("button",{type:"button",onClick:t[3]||(t[3]=(...e)=>r.update&&r.update(...e)),class:"img-button update"},E),(0,n._)("button",{type:"button",onClick:t[4]||(t[4]=(...e)=>r.remove&&r.remove(...e)),class:"img-button delete"},Z),i.data.zip_depth?((0,n.wg)(),(0,n.iD)("a",{key:0,class:"img-button zip",href:i.zipUrl},N,8,q)):(0,n.kq)("",!0)],64)):(0,n.kq)("",!0)])}var H={name:"composite",props:{data:{type:Object},editable:{type:Boolean,default:!1},editableIn:{type:Boolean,default:!1},zipUrl:{type:String}},emits:["click"],methods:{onclick(){this.$emit("click",this.data)},update(){this.$emit("update",this.data)},remove(){this.$emit("remove",this.data)},createFile(){this.$emit("createFile",this.data)},createDir(){this.$emit("createDir",this.data)}}};const J=(0,u.Z)(H,[["render",V],["__scopeId","data-v-1cdf5e30"]]);var K=J;const X=e=>((0,n.dD)("data-v-a2505fb0"),e=e(),(0,n.Cn)(),e),Y=X((()=>(0,n._)("button",{type:"submit"},"削除",-1))),A=X((()=>(0,n._)("p",null,"新規作成",-1))),G={key:0},Q={key:1},ee={type:"file",ref:"upfile"},te=X((()=>(0,n._)("button",{type:"submit"},"送信",-1))),ie={key:0},oe={key:1},ne={type:"file",ref:"upfile"},se=X((()=>(0,n._)("button",{type:"submit"},"更新",-1)));function re(e,t,i,s,r,a){return"delete"===i.selected.type?((0,n.wg)(),(0,n.iD)("form",{key:0,onSubmit:t[1]||(t[1]=(0,o.iM)(((...e)=>a.remove&&a.remove(...e)),["prevent"])),class:"composite-form"},[(0,n._)("p",null,(0,_.zw)(i.selected.data.name)+"の削除",1),Y,(0,n._)("button",{onClick:t[0]||(t[0]=(...e)=>a.close&&a.close(...e)),class:"button-link"},"閉じる")],32)):"new"===i.selected.type?((0,n.wg)(),(0,n.iD)("form",{key:1,onSubmit:t[5]||(t[5]=(0,o.iM)(((...e)=>a.add&&a.add(...e)),["prevent"])),class:"composite-form"},[A,(0,n.wy)((0,n._)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>r.form.name=e),placeholder:"名前"},null,512),[[o.nr,r.form.name]]),i.selected.data.is_dir?((0,n.wg)(),(0,n.iD)("div",G,[(0,n.wy)((0,n._)("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=e=>r.form.zip_depth=e),placeholder:"ZIP階層"},null,512),[[o.nr,r.form.zip_depth]])])):((0,n.wg)(),(0,n.iD)("div",Q,[(0,n._)("input",ee,null,512)])),te,(0,n._)("button",{onClick:t[4]||(t[4]=(...e)=>a.close&&a.close(...e)),class:"button-link"},"閉じる")],32)):"update"===i.selected.type?((0,n.wg)(),(0,n.iD)("form",{key:2,onSubmit:t[10]||(t[10]=(0,o.iM)(((...e)=>a.update&&a.update(...e)),["prevent"])),class:"composite-form"},[(0,n._)("p",null,(0,_.zw)(i.selected.data.name)+"の更新",1),(0,n.wy)((0,n._)("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=e=>r.form.name=e),placeholder:"名前"},null,512),[[o.nr,r.form.name]]),(0,n.wy)((0,n._)("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=e=>r.form.parent=e),placeholder:"親ディレクトリID"},null,512),[[o.nr,r.form.parent]]),i.selected.data.is_dir?((0,n.wg)(),(0,n.iD)("div",ie,[(0,n.wy)((0,n._)("input",{type:"number","onUpdate:modelValue":t[8]||(t[8]=e=>r.form.zip_depth=e),placeholder:"ZIP階層"},null,512),[[o.nr,r.form.zip_depth]])])):((0,n.wg)(),(0,n.iD)("div",oe,[(0,n._)("input",ne,null,512)])),se,(0,n._)("button",{onClick:t[9]||(t[9]=(...e)=>a.close&&a.close(...e)),class:"button-link"},"閉じる")],32)):(0,n.kq)("",!0)}var ae=i(4736),pe={name:"composite-form",props:{selected:{type:Object}},data(){return{form:{name:"",zip_depth:0,parent:""}}},mounted(){"update"===this.selected.type&&(this.form.name=this.selected.data.name,this.form.zip_depth=this.selected.data.zip_depth,this.form.parent=this.selected.data.parent?this.selected.data.parent:"")},methods:{add(){const e=new FormData;if(e.append("name",this.form.name),e.append("is_dir",this.selected.data.is_dir),this.selected.data.is_dir)e.append("zip_depth",this.form.zip_depth);else{const t=this.$refs.upfile.files[0];t&&e.append("src",t)}e.append("parent",this.selected.data.parent),this.$http(this.$endpoint,{credentials:"include",method:"POST",body:e,headers:{"X-CSRFToken":this.$csrfToken}}).then((e=>e.ok?e.json().then((()=>{(0,ae.bM)({title:"お知らせ",message:(0,n.h)("p",{style:"color: #009"},this.form.name+"を追加しました"),duration:2e3}),this.$emit("done")})):e.json().then((e=>{(0,ae.bM)({title:"お知らせ",message:(0,n.h)("p",{style:"color: #900"},JSON.stringify(e)),duration:2e3})}))))},update(){const e=new FormData;if(e.append("name",this.form.name),e.append("is_dir",this.selected.data.is_dir),this.selected.data.is_dir)e.append("zip_depth",this.form.zip_depth);else{const t=this.$refs.upfile.files[0];t&&e.append("src",t)}e.append("parent",this.form.parent),this.$http(this.$endpoint+this.selected.data.pk+"/",{credentials:"include",method:"PATCH",body:e,headers:{"X-CSRFToken":this.$csrfToken}}).then((e=>e.ok?e.json().then((()=>{(0,ae.bM)({title:"お知らせ",message:(0,n.h)("p",{style:"color: #009"},this.form.name+"を更新しました"),duration:2e3}),this.$emit("done")})):e.json().then((e=>{(0,ae.bM)({title:"お知らせ",message:(0,n.h)("p",{style:"color: #900"},JSON.stringify(e)),duration:2e3})}))))},remove(){this.$http(this.$endpoint+this.selected.data.pk+"/",{credentials:"include",method:"DELETE",headers:{"X-CSRFToken":this.$csrfToken}}).then((e=>{if(!e.ok)return e.json().then((e=>{(0,ae.bM)({title:"お知らせ",message:(0,n.h)("p",{style:"color: #900"},JSON.stringify(e)),duration:2e3})}));(0,ae.bM)({title:"お知らせ",message:(0,n.h)("p",{style:"color: #009"},this.selected.data.name+"を削除しました"),duration:2e3}),this.$emit("done")}))},close(){this.$emit("close")}}};const de=(0,u.Z)(pe,[["render",re],["__scopeId","data-v-a2505fb0"]]);var le=de,ce={name:"composite-list",components:{Composite:K,CompositeForm:le},props:{path:{type:String}},watch:{$route(){this.path?this.getCompositeListFromPath(this.path):this.getCompositeListTop()}},data(){return{current:{},selected:{type:null,data:{}}}},created(){this.path?this.getCompositeListFromPath(this.path):this.getCompositeListTop()},methods:{getCompositeListTop(){this.$http(this.$endpoint).then((e=>e.json())).then((e=>{this.current={composite_set:e}}))},getCompositeListFromPk(e){this.$http(this.$endpoint+e+"/").then((e=>e.json())).then((e=>{this.current=e}))},getCompositeListFromPath(e){this.$http(this.$endpoint+"get_composite_from_path/"+e.join("/")).then((e=>e.json())).then((e=>{this.current=e}))},move(e){const t=this.getNextPath(e);e.is_dir?(this.$router.push(t),this.getCompositeListFromPk(e.pk)):window.open(this.$fileUrlBase+t,"_blank")},getNextPath(e){let t=this.$route.path;t.endsWith("/")||(t+="/");let i=t+e.name;return e.is_dir&&(i+="/"),i},getBeforePath(){const e=[];for(const t of this.$route.path.split("/"))t&&e.push(t);return e.pop(),"/"+e.join("/")+"/"},moveBefore(){const e=this.getBeforePath();this.$router.push(e),this.current.parent?this.getCompositeListFromPk(this.current.parent.pk):this.getCompositeListTop()},update(e){this.selected.data=e,this.selected.type="update",document.getElementById("form").style.padding="10px"},remove(e){this.selected.data=e,this.selected.type="delete",document.getElementById("form").style.padding="10px"},createFile(e){this.selected.data={is_dir:!1,parent:e.pk?e.pk:""},this.selected.type="new",document.getElementById("form").style.padding="10px"},createDir(e){this.selected.data={is_dir:!0,parent:e.pk?e.pk:""},this.selected.type="new",document.getElementById("form").style.padding="10px"},zipUrl(e){return this.$zipUrlBase+e.pk+"/"},reload(){this.selected.type=null,this.selected.data={},this.current.pk?this.getCompositeListFromPk(this.current.pk):this.getCompositeListTop()},close(){this.selected.data={},this.selected.type=null,document.getElementById("form").style.padding="0px"}},computed:{getKey(){return`${this.current.pk}`}}};const ue=(0,u.Z)(ce,[["render",v],["__scopeId","data-v-660a7496"]]);var me=ue;const he=[{path:"/home/:path*",name:"home",component:me,props:!0}],fe=(0,f.p7)({history:(0,f.PO)("/uploader/"),routes:he,scrollBehavior(e,t,i){return i||{top:0,left:0}}});var ge=fe,ye=i(935),ke=e=>{e.use(ae.ZP,{locale:ye.Z})};const be=(0,o.ri)(h);ke(be),be.config.globalProperties.$http=(e,t)=>fetch(e,t),be.config.globalProperties.$endpoint="/uploader/api/composites/",be.config.globalProperties.$fileUrlBase="/uploader",be.config.globalProperties.$zipUrlBase="/uploader/zip/";const ve=e=>{if(document.cookie&&""!==document.cookie)for(const t of document.cookie.split(";")){const[i,o]=t.trim().split("=");if(i===e)return decodeURIComponent(o)}};be.config.globalProperties.$csrfToken=ve("csrftoken"),be.use(ge),be.use({render:e=>e(h)}),be.mount("#app")}},t={};function i(o){var n=t[o];if(void 0!==n)return n.exports;var s=t[o]={id:o,loaded:!1,exports:{}};return e[o].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}i.m=e,function(){var e=[];i.O=function(t,o,n,s){if(!o){var r=1/0;for(l=0;l<e.length;l++){o=e[l][0],n=e[l][1],s=e[l][2];for(var a=!0,p=0;p<o.length;p++)(!1&s||r>=s)&&Object.keys(i.O).every((function(e){return i.O[e](o[p])}))?o.splice(p--,1):(a=!1,s<r&&(r=s));if(a){e.splice(l--,1);var d=n();void 0!==d&&(t=d)}}return t}s=s||0;for(var l=e.length;l>0&&e[l-1][2]>s;l--)e[l]=e[l-1];e[l]=[o,n,s]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){i.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){i.p="/uploader/"}(),function(){var e={143:0};i.O.j=function(t){return 0===e[t]};var t=function(t,o){var n,s,r=o[0],a=o[1],p=o[2],d=0;if(r.some((function(t){return 0!==e[t]}))){for(n in a)i.o(a,n)&&(i.m[n]=a[n]);if(p)var l=p(i)}for(t&&t(o);d<r.length;d++)s=r[d],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return i.O(l)},o=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=i.O(void 0,[998],(function(){return i(2417)}));o=i.O(o)})();
//# sourceMappingURL=app.45f9e4e1.js.map